{"version":3,"sources":["../../../../../src/client/components/forms/Form/index.js"],"names":["Form","props","state","fields","buildFields","status","undefined","processing","childRefs","bind","handleChange","submit","renderChildren","React","Children","map","children","child","name","value","required","e","newState","target","setState","isValid","Object","keys","forEach","field","current","validated","validate","valid","preventDefault","onSubmit","ajax","data","requests","method","action","then","res","redirect","history","push","message","msg","type","error","console","log","clearAfterSubmit","cloneElement","ref","el","change","disabled","Status","className","Component"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { withRouter } from 'react-router-dom';\n\nimport { ajax } from 'payload';\n\nimport './index.css';\n\nclass Form extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      fields: this.buildFields(),\n      status: undefined,\n      processing: false\n    };\n\n    // Fill from renderChildren\n    this.childRefs = {};\n\n    this.buildFields = this.buildFields.bind(this);\n    this.handleChange = this.handleChange.bind(this);\n    this.submit = this.submit.bind(this);\n    this.renderChildren = this.renderChildren.bind(this);\n  }\n\n  buildFields() {\n    let fields = {};\n\n    React.Children.map(this.props.children, (child) => {\n      if (child.props.name) {\n        fields[child.props.name] = {\n          value: child.props.value ? child.props.value : '',\n          required: child.props.required\n        };\n      }\n    });\n\n    return fields;\n  }\n\n  handleChange(e) {\n    let newState = { ...this.state };\n    newState.fields[e.target.name].value = e.target.value;\n    this.setState(newState);\n  }\n\n  submit(e) {\n    let isValid = true;\n    let newState = { ...this.state };\n\n    Object.keys(this.childRefs).forEach((field) => {\n      if (this.childRefs[field].props.required) {\n        let current = this.childRefs[field];\n\n        let validated = current.validate();\n\n        newState.fields[field].valid = validated;\n\n        if (!validated) {\n          isValid = false;\n        }\n      }\n    });\n\n    // Update validated fields\n    this.setState(newState);\n\n    // If not valid, prevent submission\n    if (!isValid) {\n      e.preventDefault();\n\n    // If submit handler comes through via props, run that\n    } else if (this.props.onSubmit) {\n      e.preventDefault();\n      this.props.onSubmit(this.state.fields);\n\n    // If form is AJAX, fetch data\n    } else if (this.props.ajax) {\n      e.preventDefault();\n      let data = {};\n\n      // Clean up data passed from field state\n      Object.keys(this.state.fields).forEach((field) => {\n        data[field] = this.state.fields[field].value;\n      });\n\n      this.setState({\n        processing: true\n      });\n\n      // Make the API call from the action\n      ajax.requests[this.props.method](this.props.action, data).then(\n        (res) => {\n          // Provide form data to the redirected page\n          if (this.props.redirect) {\n            this.props.history.push(this.props.redirect, data);\n          } else {\n            this.setState({\n              status: {\n                message: res.msg,\n                type: 'success'\n              },\n              processing: false\n            });\n          }\n        },\n        (error) => {\n          console.log(error);\n          this.setState({\n            status: {\n              message: 'Sorry, there was a problem with your request.',\n              type: 'error'\n            },\n            processing: false\n          });\n        }\n      );\n    }\n\n    if (this.props.clearAfterSubmit && isValid) {\n      // Loop through fields - if not valid, set to invalid, rerender with error\n      Object.keys(this.state.fields).forEach((field) => {\n        newState.fields[field].value = '';\n      });\n    }\n\n    // If valid and not AJAX submit as usual\n    return;\n  }\n\n  renderChildren() {\n    let children = React.Children.map(this.props.children, (child) => {\n      if (child.props.name) {\n        // Initialize validation as true - only show error class if error after blur\n        let valid = true;\n\n        // If a valid value has been passed from field, set valid equal to that\n        if (typeof this.state.fields[child.props.name].valid !== 'undefined') {\n          valid = this.state.fields[child.props.name].valid;\n        }\n\n        return React.cloneElement(child, {\n          ref: (el) => {\n            this.childRefs[child.props.name] = el;\n          },\n          change: this.handleChange,\n          validate: this.validate,\n          valid: valid,\n          value: this.state.fields[child.props.name].value\n        });\n      }\n\n      if (child.props.type === 'submit') {\n        return React.cloneElement(child, {\n          disabled: this.state.processing || child.props.disabled === 'disabled' ? 'disabled' : false,\n          children: this.state.processing ? 'Processing...' : child.props.children\n        });\n      }\n\n      return child;\n    });\n\n    return children;\n  }\n\n  render() {\n    let Status = () => {\n      return null;\n    };\n\n    if (this.state.status && !this.state.redirect) {\n      Status = () => {\n        return (\n          <div className={`status open ${this.state.status.type}`}>\n            {this.state.status.message}\n          </div>\n        );\n      };\n    }\n\n    return (\n      <form\n        onSubmit={this.submit}\n        method={this.props.method}\n        action={this.props.action}\n        className={this.props.className}>\n        <Status />\n        {this.renderChildren()}\n      </form>\n    );\n  }\n}\n\nexport default withRouter(Form);\n"],"file":"index.js"}