@import '../../../scss/styles.scss';

//////////////////////
// HELPER MIXINS
//////////////////////

@mixin relatively-position-panels {
  .field-type-gutter {
    position: relative;
    right: 0;
  }

  .field-type-gutter.actions {
    position: relative;
    left: 0;
  }
}

@mixin absolutely-position-panels {
  .field-type-gutter {
    position: absolute;
    top: 0; right: 100%; bottom: 0;
  }

  .field-type-gutter.actions {
    position: absolute;
    top: 0; bottom: 0; left: 100%; right: unset;
  }
}

//////////////////////
// COMPONENT STYLES
//////////////////////

.draggable-section {
  padding-bottom: base(.5);

  .draggable-section {
    padding-bottom: 0;
  }

  &__content-wrapper {
    display: flex;
    position: relative;
  }

  &.is-closed {
    .draggable-section__content-wrapper {
      margin-bottom: base(1.75);
    }
  }

  &__section-header {
    @include blur-bg(white);
    display: flex;
    position: sticky;
    top: $top-header-offset;
    z-index: 1;
    padding: base(.75) base(.75);
    margin-left: - base(.75);
    margin-right: - base(.75);
    width: calc(100% + #{base(1.5)});

    .toggle-collapse {
      margin: 0 0 0 auto;
      transform: rotate(.5turn);

      .btn__icon {
        background-color: white;
      }

      &--is-closed {
        transform: rotate(0turn);
      }
    }
  }

  &__render-fields-wrapper {
    width: 100%;
  }

  &.is-hovered > div {
    > .field-type-gutter {
      &.actions {
        z-index: $z-nav;

        .field-type-gutter__content-container {
          box-shadow: none;
        }
      }
      .field-type-gutter__content-container {
        box-shadow: #{$style-stroke-width-m} 0px 0px 0px $color-dark-gray;
      }

      .position-panel__move-forward,
      .position-panel__move-backward {
        opacity: 1;

        &.first-row,
        &.last-row {
          opacity: .15;
          pointer-events: none;
        }
      }

      .position-panel__current-position {
        color: $color-dark-gray;
      }
    }

    .toggle-collapse {
      @include color-svg(white);

      .btn__icon {
        background-color: $color-gray;

        &:hover {
          background-color: $color-dark-gray;
        }
      }
    }
  }

  label.field-label {
    line-height: 1;
    padding-bottom: base(.75)
  }

  @include mid-break {
    @include relatively-position-panels();

    .position-panel__move-forward,
    .position-panel__move-backward {
      opacity: 1;
    }

    &__section-header {
      top: $top-header-offset-m;
    }
  }
}

//////////////////////
// EXTERNAL SCOPES
//////////////////////

.global-edit,
.collection-edit {
  @include absolutely-position-panels();

  @include mid-break {
    @include relatively-position-panels();
  }
}

.field-type.blocks .field-type.blocks,
.field-type.blocks .field-type.group,
.field-type.blocks .field-type.array,
.field-type.array .field-type.array,
.field-type.array .field-type.blocks,
.field-type.array .field-type.group {
  @include relatively-position-panels();
}

.field-type.group {
  @include absolutely-position-panels();

  @include mid-break {
    @include relatively-position-panels();
  }
}

// remove padding above array rows to level
// the line with the top of the input label
.field-type.array {
  .draggable-section {
    &__content-wrapper {
      padding-top: 0;
    }
  }
}
